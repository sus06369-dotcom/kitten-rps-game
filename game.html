<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kitten RPS Game - Play</title>
<style>
body {
    background: linear-gradient(to bottom, #f5f0e1, #e8dfc6);
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-direction: column;
    margin: 0;
    padding: 0 10px;
    box-sizing: border-box;
    min-height: 100vh;
}

.center-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-top: 5vh;
    text-align: center;
    position: relative;
}

.fade-in { opacity: 0; transition: opacity 0.8s; }
.visible { opacity: 1; }

#intro-text { color: #4b0082; font-size: 8vw; font-weight: bold; margin-bottom: 3vh; word-break: keep-all; }

#kitten-container { position: relative; margin-bottom: 3vh; }

#kitten-img { max-width: 220px; height: auto; margin-bottom: 3vh; }

/* é›»è…¦å‡ºæ‹³å›ºå®šä½ç½® */
#computer-choice {
    position: absolute;
    bottom: 10px;   /* è²“å’ªå·¦ä¸‹ */
    left: -30px;    /* å¾®èª¿ä½ç½® */
    width: 130px;   /* å›ºå®šå¤§å° */
    height: auto;
    z-index: 2;
    transition: none; /* é¿å…å¹³ç§»å‹•ç•« */
}

/* å°è©ï¼šåœ¨è²“å’ªä¸Šæ–¹ */
#dialogue-text {
    position: absolute;
    top: -90px;      
    left: 50%;
    transform: translateX(-50%);
    color: #4b0082;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    max-width: 1000px;  
    line-height: 1.2;
    z-index: 3;
    word-break: break-word;
    pointer-events: none;
    white-space: normal;
}

/* æ–°å¢ä¸æ¨‚æ„æ–‡å­—é¡¯ç¤º */
#no-text {
    color: #4b0082;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    margin-top: 15px;
    opacity: 0;
    transition: opacity 0.8s;
}

/* å…¶é¤˜æ¨£å¼ä¿ç•™ */
#emoji-display { font-size: 45vw; position: absolute; top: 52%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; line-height: 1; z-index: 5; }

.choice-buttons { display: flex; gap: 30px; margin-bottom: 3vh; }
.choice-buttons button { padding: 12px 30px; font-size: 20px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; transition: transform 0.2s; }
.choice-buttons button:hover { transform: scale(1.05); }
#yes-btn { background-color: #6ca0dc; color: #fff; } 
#no-btn { background-color: #e58b8b; color: #fff; }

#status-text { color: #4b0082; font-size: 6vw; font-weight: bold; margin-bottom: 0.5vh; }
#hint-text { color: #4b0082; font-size: 5vw; margin-bottom: 3vh; }
#result { margin: 15px 0; }

#game-display { display: flex; flex-direction: column; justify-content: space-between; align-items: center; height: 200px; position: relative; }
.player-buttons { display: flex; gap: 30px; }
.player-buttons img { width: 70px; height: 70px; cursor: pointer; opacity: 0; transform: translateY(20px); transition: opacity 0.8s, transform 0.8s; }

/* å½©å±‘å’Œç´ ææ‰è½æ¨£å¼ */
.falling-item { position: fixed; pointer-events: none; top: -50px; animation-name: fall; animation-timing-function: ease-in; animation-fill-mode: forwards; z-index: 20; }
@keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity:1; } 100% { transform: translateY(100vh) rotate(360deg); opacity:0; } }
</style>
</head>
<body>

<div class="center-container">
    <div id="intro-text" class="fade-in">å˜¿ï¼Œèƒ½å’Œå°è²“çŒœå€‹æ‹³å—ï¼Ÿ</div>
    
    <div id="kitten-container">
        <div id="dialogue-text"></div>
        <img src="kitten.png" id="kitten-img" class="fade-in">
        <img src="" id="computer-choice" alt="">
        <div id="emoji-display"></div>
    </div>

    <div class="choice-buttons fade-in" id="choice-btns" style="visibility:hidden;">
        <button id="yes-btn">å¾ˆæ¨‚æ„</button>
        <button id="no-btn">ä¸æ¨‚æ„</button>
    </div>

    <!-- æ–°å¢é¡¯ç¤ºä¸æ¨‚æ„é»æ“Šæ–‡å­— -->
    <div id="no-text"></div>

    <div id="status-text" class="fade-in" style="visibility:hidden;">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
    <div id="hint-text" class="fade-in" style="visibility:hidden;">å¥½äº†å°±é»æ“Šå‡ºæ‹³å§</div>

    <div id="game-display">
        <div id="result"></div>
        <div class="player-buttons" id="player-buttons">
            <img src="r.png" alt="å‰ªåˆ€" data-choice="r">
            <img src="g.png" alt="çŸ³é ­" data-choice="g">
            <img src="b.png" alt="å¸ƒ" data-choice="b">
        </div>
    </div>
</div>

<script>
const introText = document.getElementById('intro-text');
const kittenImg = document.getElementById('kitten-img');
const choiceBtns = document.getElementById('choice-btns');
const yesBtn = document.getElementById('yes-btn');
const noBtn = document.getElementById('no-btn');
const statusText = document.getElementById('status-text');
const hintText = document.getElementById('hint-text');
const playerButtons = document.querySelectorAll('#player-buttons img');
const playerBtnContainer = document.getElementById('player-buttons');
const computerChoiceImg = document.getElementById('computer-choice');
const resultDiv = document.getElementById('result');
const dialogueText = document.getElementById('dialogue-text');
const emojiDisplay = document.getElementById('emoji-display');
const noText = document.getElementById('no-text');

const computerOptions = ['scissors2.png','rock2.png','paper2.png'];
let noClickCount = 0;
let firstClick = true;

/* ---------------------------
   ä½ åŸæœ¬çš„å®Œæ•´å°è©æ± 
--------------------------- */
const catDialogues = {
    /* é€™è£¡æ”¾ä½ åŸæœ¬çš„ catDialogues ç‰©ä»¶ */
};

/* é€£å‹/é€£æ•—/å¹³æ‰‹è¨ˆæ•¸ */
let winStreak = 0;   
let loseStreak = 0;  
let drawStreak = 0;  

/* é€å­—é¡¯ç¤ºæ§åˆ¶ */
let typingInterval = null;
function showDialogue(text){
    if(typingInterval) clearInterval(typingInterval);
    dialogueText.textContent = '';
    let i = 0;
    typingInterval = setInterval(()=>{
        dialogueText.textContent += text.charAt(i);
        i++;
        if(i >= text.length){
            clearInterval(typingInterval);
            typingInterval = null;
        }
    }, 40);
}

/* é¸ä¸€å¥åˆé©çš„å°è© */
function pickDialogue(result){
    let list;
    if(result === 'Win'){ 
        winStreak++;
        loseStreak = 0;
        drawStreak = 0;
        if(winStreak >= 5) list = catDialogues.lose[5];
        else if(winStreak === 4) list = catDialogues.lose[4];
        else if(winStreak >= 2) list = catDialogues.lose[2];
        else list = catDialogues.lose[1];
    } else if(result === 'Lose'){ 
        loseStreak++;
        winStreak = 0;
        drawStreak = 0;
        if(loseStreak >= 5) list = catDialogues.win[5];
        else if(loseStreak === 4) list = catDialogues.win[4];
        else if(loseStreak >= 2) list = catDialogues.win[2];
        else list = catDialogues.win[1];
    } else { 
        drawStreak++;
        winStreak = 0;
        loseStreak = 0;
        if(drawStreak >= 2) list = catDialogues.draw.streak;
        else list = catDialogues.draw.normal;
    }
    return list[Math.floor(Math.random() * list.length)];
}

/* ---------- åˆå§‹æ·¡å…¥ ---------- */
setTimeout(()=>{introText.classList.add('visible');}, 200);
setTimeout(()=>{kittenImg.classList.add('visible');}, 1000);
setTimeout(()=>{choiceBtns.style.visibility='visible'; choiceBtns.classList.add('visible');}, 1800);

/* ä¸æ¨‚æ„æŒ‰éˆ• */
noBtn.addEventListener('click',()=>{
    noClickCount++;
    if(noClickCount === 1) emojiDisplay.textContent='ğŸ¥º';
    else if(noClickCount === 2) emojiDisplay.textContent='ğŸ¥¹';
    
    // ç¬¬3~6æ¬¡é»æ“Šæ–‡å­—æ·¡å…¥
    if(noClickCount === 3) noText.textContent='ä½ å¿å¿ƒå—...?'; 
    else if(noClickCount === 4) noText.textContent='è³å€‹è‡‰è·Ÿå°è²“ä¾†ä¸€å±€å§...ğŸ¥¹'; 
    else if(noClickCount === 5) noText.textContent='â€¦â€¦ä½ çœŸçš„é€™éº¼ä¸æƒ³é™ªå’ªå—ï¼ŸğŸ¥º'; 
    else if(noClickCount >= 6) noText.textContent='å¥½å§â€¦â€¦é‚£æƒ³ç©çš„æ™‚å€™å†ä¾†æ‰¾å’ªå§...ğŸ¥¹';
    
    // æ–‡å­—æ·¡å…¥
    if(noClickCount >= 3){
        noText.style.opacity='0';
        void noText.offsetWidth; // é‡æ–°è§¸ç™¼ transition
        noText.style.opacity='1';
    }
});

/* å¾ˆæ¨‚æ„æŒ‰éˆ• */
yesBtn.addEventListener('click',()=>{
    introText.style.display='none';
    choiceBtns.style.display='none';
    emojiDisplay.textContent='';
    noText.style.opacity='0'; // éš±è—ä¸æ¨‚æ„æ–‡å­—

    setTimeout(()=>{statusText.style.visibility='visible'; statusText.classList.add('visible');},200);
    setTimeout(()=>{hintText.style.visibility='visible'; hintText.classList.add('visible');},1000);
    setTimeout(()=>{
        playerBtnContainer.style.visibility='visible';
        playerButtons.forEach((btn, i)=>{
            setTimeout(()=>{ btn.style.opacity='1'; btn.style.transform='translateY(0)'; }, i*400);
        });
    },1800);
});

/* ---------- ç©å®¶å‡ºæ‹³ä¸»æµç¨‹ ---------- */
playerButtons.forEach(btn=>{
    btn.addEventListener('click',()=>{
        const playerChoice = btn.getAttribute('data-choice');
        const computerChoiceFile = computerOptions[Math.floor(Math.random()*3)];
        computerChoiceImg.src = computerChoiceFile;
        if(firstClick){
            statusText.style.display='none';
            hintText.style.display='none';
            firstClick=false;
        }

        let result = '';
        if(playerChoice==='r'){
            if(computerChoiceFile==='scissors2.png') result='Draw';
            else if(computerChoiceFile==='rock2.png') result='Lose';
            else result='Win';
        } else if(playerChoice==='g'){
            if(computerChoiceFile==='scissors2.png') result='Win';
            else if(computerChoiceFile==='rock2.png') result='Draw';
            else result='Lose';
        } else if(playerChoice==='b'){
            if(computerChoiceFile==='scissors2.png') result='Lose';
            else if(computerChoiceFile==='rock2.png') result='Win';
            else result='Draw';
        }

        if(result==='Win') resultDiv.innerHTML = `<img src="Victory.png" style="max-width:150px;">`;
        else if(result==='Lose') resultDiv.innerHTML = `<img src="Defeat.png" style="max-width:150px;">`;
        else if(result==='Draw') resultDiv.innerHTML = `<img src="Draw.png" style="max-width:150px;">`;

        const line = pickDialogue(result);
        showDialogue(line);

        if(result==='Win'){
            const fallingItems=['c.png','ch.png','pp.png'];
            const colors=['#f94144','#f3722c','#f9c74f','#90be6d','#43aa8b','#577590','#f72585','#7209b7'];
            for(let i=0;i<60;i++){
                const item=document.createElement('img');
                const file=fallingItems[Math.floor(Math.random()*fallingItems.length)];
                item.src=file;
                item.className='falling-item';
                item.style.left=Math.random()*100+'vw';
                const scale=1+Math.random()*1.0;
                item.style.width=(30*scale)+'px';
                item.style.height=(30*scale)+'px';
                item.style.animationDuration=(2 + Math.random()*2)+'s';
                item.style.transform=`rotate(${Math.random()*360}deg)`;
                document.body.appendChild(item);
                setTimeout(()=>{document.body.removeChild(item);},4000);

                const confetti=document.createElement('div');
                confetti.className='falling-item';
                confetti.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
                const size=12 + Math.random()*18;
                confetti.style.width=size+'px';
                confetti.style.height=size+'px';
                confetti.style.left=Math.random()*100+'vw';
                confetti.style.borderRadius='2px';
                confetti.style.animationDuration=(2 + Math.random()*2)+'s';
                confetti.style.transform=`rotate(${Math.random()*360}deg)`;
                document.body.appendChild(confetti);
                setTimeout(()=>{document.body.removeChild(confetti);},4000);
            }
        }
    });
});
</script>

</body>
</html>
